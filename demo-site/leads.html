<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciar Leads | Backoffice IMI</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/backoffice.css">
    <script src="js/icons.js"></script>
</head>

<body class="admin-body">
    <!-- Sidebar -->
    <aside class="admin-sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>IMI</h2>
            <p>Backoffice</p>
        </div>

        <nav class="sidebar-nav">
            <a href="backoffice.html" class="sidebar-link">
                <span class="sidebar-icon" id="icon-dashboard"></span>
                <span>Dashboard</span>
            </a>
            <a href="properties-list.html" class="sidebar-link">
                <span class="sidebar-icon" id="icon-building"></span>
                <span>Imóveis</span>
            </a>
            <a href="leads.html" class="sidebar-link active">
                <span class="sidebar-icon" id="icon-users"></span>
                <span>Leads</span>
                <span class="badge-count">12</span>
            </a>
            <a href="users.html" class="sidebar-link">
                <span class="sidebar-icon" id="icon-shield"></span>
                <span>Usuários</span>
            </a>
            <a href="reports.html" class="sidebar-link">
                <span class="sidebar-icon" id="icon-chart"></span>
                <span>Relatórios</span>
            </a>
            <a href="settings.html" class="sidebar-link">
                <span class="sidebar-icon" id="icon-settings"></span>
                <span>Configurações</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button onclick="logout()" class="sidebar-link logout-btn">
                <span class="sidebar-icon" id="icon-logout"></span>
                <span>Sair</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <!-- Header -->
        <header class="admin-topbar">
            <button class="mobile-menu-toggle" onclick="toggleSidebar()">
                <span class="hamburger"></span>
            </button>

            <h1>Leads</h1>

            <div class="topbar-actions">
                <button class="btn-icon-topbar" onclick="exportLeads()" title="Exportar para CSV">
                    <span id="icon-download"></span>
                </button>
                <span class="user-badge" id="user-email"></span>
            </div>
        </header>

        <!-- Content -->
        <div class="admin-content">
            <div class="alert-container"></div>

            <!-- Stats Cards -->
            <div class="stats-grid-compact">
                <div class="stat-card-compact">
                    <div class="stat-icon new">
                        <span id="icon-stat-new"></span>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">Novos</span>
                        <span class="stat-value">5</span>
                    </div>
                </div>
                <div class="stat-card-compact">
                    <div class="stat-icon progress">
                        <span id="icon-stat-progress"></span>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">Em Andamento</span>
                        <span class="stat-value">4</span>
                    </div>
                </div>
                <div class="stat-card-compact">
                    <div class="stat-icon success">
                        <span id="icon-stat-success"></span>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">Convertidos</span>
                        <span class="stat-value">3</span>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters-bar">
                <div class="filter-tabs">
                    <button class="filter-tab active" onclick="filterLeads('all')">
                        Todos <span class="tab-count">12</span>
                    </button>
                    <button class="filter-tab" onclick="filterLeads('new')">
                        Novos <span class="tab-count">5</span>
                    </button>
                    <button class="filter-tab" onclick="filterLeads('progress')">
                        Em Andamento <span class="tab-count">4</span>
                    </button>
                    <button class="filter-tab" onclick="filterLeads('converted')">
                        Convertidos <span class="tab-count">3</span>
                    </button>
                </div>

                <div class="search-box">
                    <span class="search-icon" id="icon-search"></span>
                    <input type="text" placeholder="Buscar leads..." onkeyup="searchLeads(this.value)">
                </div>
            </div>

            <!-- Leads List -->
            <div class="leads-grid" id="leads-container">
                <!-- Lead Card 1 - Novo -->
                <div class="lead-card" data-status="new" data-id="1">
                    <div class="lead-header">
                        <div class="lead-avatar">JM</div>
                        <div class="lead-info">
                            <h3>João Mendes</h3>
                            <p class="lead-email">joao.mendes@email.com</p>
                        </div>
                        <span class="lead-status status-new">Novo</span>
                    </div>

                    <div class="lead-body">
                        <div class="lead-detail">
                            <span class="detail-icon" id="icon-phone-1"></span>
                            <span>(81) 99876-5432</span>
                        </div>
                        <div class="lead-detail">
                            <span class="detail-icon" id="icon-building-1"></span>
                            <span>Interesse: Apartamento Premium em Jardins</span>
                        </div>
                        <div class="lead-detail">
                            <span class="detail-icon" id="icon-time-1"></span>
                            <span>Há 2 horas</span>
                        </div>
                    </div>

                    <div class="lead-message">
                        <p>"Gostaria de agendar uma visita ao apartamento em Jardins. Tenho interesse em conhecer
                            pessoalmente."</p>
                    </div>

                    <div class="lead-actions">
                        <button class="btn btn-primary btn-sm" onclick="openLeadModal(1)">
                            <span id="icon-eye-1"></span>
                            Ver Detalhes
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="contactLead('5581998765432')">
                            <span id="icon-whatsapp-1"></span>
                            WhatsApp
                        </button>
                    </div>
                </div>

                <!-- Lead Card 2 - Em Andamento -->
                <div class="lead-card" data-status="progress" data-id="2">
                    <div class="lead-header">
                        <div class="lead-avatar">MS</div>
                        <div class="lead-info">
                            <h3>Maria Silva</h3>
                            <p class="lead-email">maria.silva@email.com</p>
                        </div>
                        <span class="lead-status status-progress">Em Andamento</span>
                    </div>

                    <div class="lead-body">
                        <div class="lead-detail">
                            <span class="detail-icon" id="icon-phone-2"></span>
                            <span>(81) 99123-4567</span>
                        </div>
                        <div class="lead-detail">
                            <span class="detail-icon" id="icon-building-2"></span>
                            <span>Interesse: Casa em Condomínio Fechado</span>
                        </div>
                        <div class="lead-detail">
                            <span class="detail-icon" id="icon-time-2"></span>
                            <span>Há 1 dia</span>
                        </div>
                    </div>

                    <div class="lead-message">
                        <p>"Preciso de uma avaliação técnica para financiamento. Qual o prazo e valor?"</p>
                    </div>

                    <div class="lead-timeline">
                        <div class="timeline-item">
                            <span class="timeline-dot"></span>
                            <span class="timeline-text">Primeiro contato realizado</span>
                        </div>
                        <div class="timeline-item">
                            <span class="timeline-dot"></span>
                            <span class="timeline-text">Orçamento enviado</span>
                        </div>
                    </div>

                    <div class="lead-actions">
                        <button class="btn btn-primary btn-sm" onclick="openLeadModal(2)">
                            <span id="icon-eye-2"></span>
                            Ver Detalhes
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="contactLead('5581991234567')">
                            <span id="icon-whatsapp-2"></span>
                            WhatsApp
                        </button>
                    </div>
                </div>

                <!-- Lead Card 3 - Convertido -->
                <div class="lead-card" data-status="converted" data-id="3">
                    <div class="lead-header">
                        <div class="lead-avatar">PC</div>
                        <div class="lead-info">
                            <h3>Pedro Costa</h3>
                            <p class="lead-email">pedro.costa@email.com</p>
                        </div>
                        <span class="lead-status status-converted">Convertido</span>
                    </div>

                    <div class="lead-body">
                        <div class="lead-detail">
                            <span class="detail-icon" id="icon-phone-3"></span>
                            <span>(81) 99555-7788</span>
                        </div>
                        <div class="lead-detail">
                            <span class="detail-icon" id="icon-building-3"></span>
                            <span>Serviço: Avaliação Técnica</span>
                        </div>
                        <div class="lead-detail">
                            <span class="detail-icon" id="icon-time-3"></span>
                            <span>Há 3 dias</span>
                        </div>
                    </div>

                    <div class="lead-message">
                        <p>"Avaliação concluída. Cliente satisfeito com o serviço prestado."</p>
                    </div>

                    <div class="conversion-badge">
                        <span id="icon-check-badge"></span>
                        <span>Serviço contratado - R$ 2.500,00</span>
                    </div>

                    <div class="lead-actions">
                        <button class="btn btn-primary btn-sm" onclick="openLeadModal(3)">
                            <span id="icon-eye-3"></span>
                            Ver Detalhes
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="contactLead('5581995557788')">
                            <span id="icon-whatsapp-3"></span>
                            WhatsApp
                        </button>
                    </div>
                </div>

                <!-- More leads... (simulação) -->
                <div class="lead-card" data-status="new" data-id="4">
                    <div class="lead-header">
                        <div class="lead-avatar">AS</div>
                        <div class="lead-info">
                            <h3>Ana Santos</h3>
                            <p class="lead-email">ana.santos@email.com</p>
                        </div>
                        <span class="lead-status status-new">Novo</span>
                    </div>

                    <div class="lead-body">
                        <div class="lead-detail">
                            <span class="detail-icon" id="icon-phone-4"></span>
                            <span>(81) 99444-3322</span>
                        </div>
                        <div class="lead-detail">
                            <span class="detail-icon" id="icon-building-4"></span>
                            <span>Interesse: Consultoria Estratégica</span>
                        </div>
                        <div class="lead-detail">
                            <span class="detail-icon" id="icon-time-4"></span>
                            <span>Há 30 minutos</span>
                        </div>
                    </div>

                    <div class="lead-message">
                        <p>"Preciso de consultoria para investimento em imóveis comerciais. Pode me ajudar?"</p>
                    </div>

                    <div class="lead-actions">
                        <button class="btn btn-primary btn-sm" onclick="openLeadModal(4)">
                            <span id="icon-eye-4"></span>
                            Ver Detalhes
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="contactLead('5581994443322')">
                            <span id="icon-whatsapp-4"></span>
                            WhatsApp
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Lead Detail Modal -->
    <div class="modal" id="lead-modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Detalhes do Lead</h2>
                <button class="modal-close" onclick="closeLeadModal()">
                    <span id="icon-close"></span>
                </button>
            </div>

            <div class="modal-body">
                <div class="lead-detail-grid">
                    <!-- Left Column -->
                    <div class="lead-detail-section">
                        <h3>Informações de Contato</h3>
                        <div class="detail-row">
                            <span class="detail-label">Nome:</span>
                            <span class="detail-value" id="modal-name">João Mendes</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">E-mail:</span>
                            <span class="detail-value" id="modal-email">joao.mendes@email.com</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Telefone:</span>
                            <span class="detail-value" id="modal-phone">(81) 99876-5432</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Origem:</span>
                            <span class="detail-value">Formulário do Site</span>
                        </div>

                        <h3 style="margin-top: 2rem;">Interesse</h3>
                        <div class="detail-row">
                            <span class="detail-label">Tipo:</span>
                            <span class="detail-value">Imóvel</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Imóvel:</span>
                            <span class="detail-value">Apartamento Premium em Jardins</span>
                        </div>

                        <h3 style="margin-top: 2rem;">Mensagem</h3>
                        <p class="lead-message-full" id="modal-message">
                            "Gostaria de agendar uma visita ao apartamento em Jardins. Tenho interesse em conhecer
                            pessoalmente e gostaria de saber mais sobre as condições de pagamento."
                        </p>
                    </div>

                    <!-- Right Column -->
                    <div class="lead-detail-section">
                        <h3>Status e Acompanhamento</h3>
                        <div class="form-group">
                            <label class="form-label">Status Atual</label>
                            <select class="form-select" id="modal-status">
                                <option value="new">Novo</option>
                                <option value="progress">Em Andamento</option>
                                <option value="converted">Convertido</option>
                                <option value="lost">Perdido</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Prioridade</label>
                            <select class="form-select">
                                <option value="high">Alta</option>
                                <option value="medium" selected>Média</option>
                                <option value="low">Baixa</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Adicionar Nota</label>
                            <textarea class="form-textarea"
                                placeholder="Adicione observações sobre este lead..."></textarea>
                        </div>

                        <button class="btn btn-primary" style="width: 100%;" onclick="saveLeadNotes()">
                            Salvar Anotações
                        </button>

                        <h3 style="margin-top: 2rem;">Histórico</h3>
                        <div class="lead-history">
                            <div class="history-item">
                                <div class="history-dot"></div>
                                <div class="history-content">
                                    <span class="history-title">Lead criado</span>
                                    <span class="history-time">30/01/2026 14:23</span>
                                </div>
                            </div>
                            <div class="history-item">
                                <div class="history-dot"></div>
                                <div class="history-content">
                                    <span class="history-title">Status alterado para "Novo"</span>
                                    <span class="history-time">30/01/2026 14:23</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button onclick="contactLead('5581998765432')" class="btn btn-secondary">
                    <span id="icon-whatsapp-modal"></span>
                    Contatar via WhatsApp
                </button>
                <button onclick="closeLeadModal()" class="btn btn-outline">Fechar</button>
            </div>
        </div>
    </div>

    <script src="js/backoffice.js"></script>
    <script src="js/leads.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            initializeIcons();
        });

        function initializeIcons() {
            // Sidebar
            document.getElementById('icon-dashboard').innerHTML = IMIIcons.dashboard;
            document.getElementById('icon-building').innerHTML = IMIIcons.building;
            document.getElementById('icon-users').innerHTML = IMIIcons.users;
            document.getElementById('icon-shield').innerHTML = IMIIcons.shield;
            document.getElementById('icon-chart').innerHTML = IMIIcons.chart;
            document.getElementById('icon-settings').innerHTML = IMIIcons.settings;
            document.getElementById('icon-logout').innerHTML = IMIIcons.logout;

            // Header
            document.getElementById('icon-download').innerHTML = IMIIcons.download;
            document.getElementById('icon-search').innerHTML = IMIIcons.search;
            document.getElementById('icon-close').innerHTML = IMIIcons.x;

            // Stats
            document.getElementById('icon-stat-new').innerHTML = IMIIcons.mail;
            document.getElementById('icon-stat-progress').innerHTML = IMIIcons.target;
            document.getElementById('icon-stat-success').innerHTML = IMIIcons.check;

            // Lead cards icons
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`icon-phone-${i}`).innerHTML = IMIIcons.phone;
                document.getElementById(`icon-building-${i}`).innerHTML = IMIIcons.building;
                document.getElementById(`icon-time-${i}`).innerHTML = IMIIcons.info;
                document.getElementById(`icon-eye-${i}`).innerHTML = IMIIcons.eye;
                document.getElementById(`icon-whatsapp-${i}`).innerHTML = IMIIcons.phone;
            }

            document.getElementById('icon-check-badge').innerHTML = IMIIcons.check;
            document.getElementById('icon-whatsapp-modal').innerHTML = IMIIcons.phone;
        }

        function contactLead(phone) {
            window.open(`https://wa.me/${phone}?text=Olá! Vi seu interesse através do site da IMI.`, '_blank');
        }

        function exportLeads() {
            showAlert('Exportando leads para CSV...', 'success');
            // Implementar export real
        }
    </script>
</body>

</html>