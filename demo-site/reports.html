<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatórios | Backoffice IMI</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/backoffice.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="js/icons.js"></script>
</head>

<body class="admin-body">
    <!-- Sidebar -->
    <aside class="admin-sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>IMI</h2>
            <p>Backoffice</p>
        </div>

        <nav class="sidebar-nav">
            <a href="backoffice.html" class="sidebar-link">
                <span class="sidebar-icon" id="icon-dashboard"></span>
                <span>Dashboard</span>
            </a>
            <a href="properties-list.html" class="sidebar-link">
                <span class="sidebar-icon" id="icon-building"></span>
                <span>Imóveis</span>
            </a>
            <a href="leads.html" class="sidebar-link">
                <span class="sidebar-icon" id="icon-users"></span>
                <span>Leads</span>
                <span class="badge-count">12</span>
            </a>
            <a href="users.html" class="sidebar-link">
                <span class="sidebar-icon" id="icon-shield"></span>
                <span>Usuários</span>
            </a>
            <a href="reports.html" class="sidebar-link active">
                <span class="sidebar-icon" id="icon-chart"></span>
                <span>Relatórios</span>
            </a>
            <a href="settings.html" class="sidebar-link">
                <span class="sidebar-icon" id="icon-settings"></span>
                <span>Configurações</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button onclick="logout()" class="sidebar-link logout-btn">
                <span class="sidebar-icon" id="icon-logout"></span>
                <span>Sair</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <!-- Header -->
        <header class="admin-topbar">
            <button class="mobile-menu-toggle" onclick="toggleSidebar()">
                <span class="hamburger"></span>
            </button>

            <h1>Relatórios e Analytics</h1>

            <div class="topbar-actions">
                <button class="btn-icon-topbar" onclick="exportReport()" title="Exportar Relatório">
                    <span id="icon-download"></span>
                </button>
                <span class="user-badge" id="user-email"></span>
            </div>
        </header>

        <!-- Content -->
        <div class="admin-content">
            <!-- Period Selector -->
            <div class="period-selector">
                <button class="period-btn active" onclick="changePeriod('7d', this)">7 dias</button>
                <button class="period-btn" onclick="changePeriod('30d', this)">30 dias</button>
                <button class="period-btn" onclick="changePeriod('90d', this)">90 dias</button>
                <button class="period-btn" onclick="changePeriod('1y', this)">1 ano</button>
            </div>

            <!-- KPIs -->
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-header">
                        <span class="kpi-icon revenue">
                            <span id="icon-kpi-revenue"></span>
                        </span>
                        <span class="kpi-trend positive">+12.5%</span>
                    </div>
                    <div class="kpi-value">R$ 45.250</div>
                    <div class="kpi-label">Receita Total</div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <span class="kpi-icon leads">
                            <span id="icon-kpi-leads"></span>
                        </span>
                        <span class="kpi-trend positive">+8.3%</span>
                    </div>
                    <div class="kpi-value">127</div>
                    <div class="kpi-label">Leads Recebidos</div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <span class="kpi-icon conversion">
                            <span id="icon-kpi-conversion"></span>
                        </span>
                        <span class="kpi-trend positive">+3.2%</span>
                    </div>
                    <div class="kpi-value">18.5%</div>
                    <div class="kpi-label">Taxa de Conversão</div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <span class="kpi-icon views">
                            <span id="icon-kpi-views"></span>
                        </span>
                        <span class="kpi-trend negative">-2.1%</span>
                    </div>
                    <div class="kpi-value">2.834</div>
                    <div class="kpi-label">Visualizações</div>
                </div>
            </div>

            <!-- Charts Row 1 -->
            <div class="charts-row">
                <div class="chart-card chart-large">
                    <div class="chart-header">
                        <h3>Leads por Período</h3>
                        <select class="chart-select" onchange="updateLeadsChart(this.value)">
                            <option value="daily">Diário</option>
                            <option value="weekly" selected>Semanal</option>
                            <option value="monthly">Mensal</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="leadsChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Status dos Leads</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Charts Row 2 -->
            <div class="charts-row">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Origem dos Leads</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="sourceChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Interesse por Tipo de Imóvel</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="propertyTypeChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Charts Row 3 -->
            <div class="charts-row">
                <div class="chart-card chart-large">
                    <div class="chart-header">
                        <h3>Receita Mensal</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Top Serviços</h3>
                    </div>
                    <div class="top-services">
                        <div class="service-item">
                            <div class="service-info">
                                <span class="service-name">Avaliação Técnica</span>
                                <span class="service-count">45 vendas</span>
                            </div>
                            <div class="service-bar">
                                <div class="service-progress" style="width: 85%"></div>
                            </div>
                            <span class="service-value">R$ 112.500</span>
                        </div>
                        <div class="service-item">
                            <div class="service-info">
                                <span class="service-name">Consultoria Estratégica</span>
                                <span class="service-count">28 vendas</span>
                            </div>
                            <div class="service-bar">
                                <div class="service-progress" style="width: 65%"></div>
                            </div>
                            <span class="service-value">R$ 84.000</span>
                        </div>
                        <div class="service-item">
                            <div class="service-info">
                                <span class="service-name">Corretagem</span>
                                <span class="service-count">12 vendas</span>
                            </div>
                            <div class="service-bar">
                                <div class="service-progress" style="width: 45%"></div>
                            </div>
                            <span class="service-value">R$ 36.000</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card">
                <div class="card-header">
                    <h3>Atividade Recente</h3>
                </div>
                <div class="activity-list">
                    <div class="activity-item">
                        <div class="activity-icon new-lead">
                            <span id="icon-activity-1"></span>
                        </div>
                        <div class="activity-content">
                            <span class="activity-title">Novo lead recebido</span>
                            <span class="activity-desc">João Mendes - Interesse em Apartamento Premium</span>
                            <span class="activity-time">Há 2 horas</span>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon conversion">
                            <span id="icon-activity-2"></span>
                        </div>
                        <div class="activity-content">
                            <span class="activity-title">Lead convertido</span>
                            <span class="activity-desc">Maria Silva - Avaliação Técnica contratada</span>
                            <span class="activity-time">Há 5 horas</span>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon property">
                            <span id="icon-activity-3"></span>
                        </div>
                        <div class="activity-content">
                            <span class="activity-title">Novo imóvel cadastrado</span>
                            <span class="activity-desc">Casa Alto de Pinheiros - R$ 4.500.000</span>
                            <span class="activity-time">Há 1 dia</span>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon view">
                            <span id="icon-activity-4"></span>
                        </div>
                        <div class="activity-content">
                            <span class="activity-title">Pico de visualizações</span>
                            <span class="activity-desc">Cobertura Itaim Bibi - 234 visualizações hoje</span>
                            <span class="activity-time">Há 2 dias</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="js/backoffice.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            initializeIcons();
            initializeCharts();
        });

        function initializeIcons() {
            // Sidebar
            document.getElementById('icon-dashboard').innerHTML = IMIIcons.dashboard;
            document.getElementById('icon-building').innerHTML = IMIIcons.building;
            document.getElementById('icon-users').innerHTML = IMIIcons.users;
            document.getElementById('icon-shield').innerHTML = IMIIcons.shield;
            document.getElementById('icon-chart').innerHTML = IMIIcons.chart;
            document.getElementById('icon-settings').innerHTML = IMIIcons.settings;
            document.getElementById('icon-logout').innerHTML = IMIIcons.logout;
            document.getElementById('icon-download').innerHTML = IMIIcons.download;

            // KPIs
            document.getElementById('icon-kpi-revenue').innerHTML = IMIIcons.briefcase;
            document.getElementById('icon-kpi-leads').innerHTML = IMIIcons.users;
            document.getElementById('icon-kpi-conversion').innerHTML = IMIIcons.target;
            document.getElementById('icon-kpi-views').innerHTML = IMIIcons.eye;

            // Activity
            for (let i = 1; i <= 4; i++) {
                const icons = [IMIIcons.mail, IMIIcons.check, IMIIcons.building, IMIIcons.eye];
                document.getElementById(`icon-activity-${i}`).innerHTML = icons[i - 1];
            }
        }

        function initializeCharts() {
            const primaryColor = getComputedStyle(document.documentElement).getPropertyValue('--primary-700').trim();
            const accentColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-600').trim();

            // Leads Chart
            new Chart(document.getElementById('leadsChart'), {
                type: 'line',
                data: {
                    labels: ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4'],
                    datasets: [{
                        label: 'Leads Recebidos',
                        data: [28, 35, 42, 38],
                        borderColor: primaryColor,
                        backgroundColor: primaryColor + '20',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });

            // Status Chart
            new Chart(document.getElementById('statusChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Novos', 'Em Andamento', 'Convertidos', 'Perdidos'],
                    datasets: [{
                        data: [5, 4, 3, 2],
                        backgroundColor: ['#3b82f6', '#f59e0b', '#10b981', '#ef4444']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Source Chart
            new Chart(document.getElementById('sourceChart'), {
                type: 'pie',
                data: {
                    labels: ['Site', 'WhatsApp', 'Instagram', 'Indicação'],
                    datasets: [{
                        data: [45, 25, 20, 10],
                        backgroundColor: [primaryColor, accentColor, '#10b981', '#f59e0b']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Property Type Chart
            new Chart(document.getElementById('propertyTypeChart'), {
                type: 'bar',
                data: {
                    labels: ['Apartamento', 'Casa', 'Comercial', 'Terreno'],
                    datasets: [{
                        label: 'Interesse',
                        data: [42, 28, 18, 12],
                        backgroundColor: primaryColor
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });

            // Revenue Chart
            new Chart(document.getElementById('revenueChart'), {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                    datasets: [{
                        label: 'Receita (R$)',
                        data: [32500, 28000, 35000, 42000, 38500, 45250],
                        backgroundColor: accentColor
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }

        function changePeriod(period, btn) {
            document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            showAlert(`Período alterado para: ${btn.textContent}`, 'info');
        }

        function updateLeadsChart(type) {
            showAlert(`Visualização alterada para: ${type}`, 'info');
        }

        function exportReport() {
            showAlert('Exportando relatório em PDF...', 'success');
        }
    </script>
</body>

</html>